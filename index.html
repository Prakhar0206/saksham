<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Writing Test Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5; /* A more neutral, professional background */
            /* FIX: Removed user-select: none to allow users to select prompt text. */
        }
        .ielts-header-blue { background-color: #2b5797; }
        .ielts-text-blue { color: #2b5797; }
        
        /* A more authentic, flat button style */
        .ielts-button {
            background-color: #e1e1e1;
            border: 1px solid #adadad;
            border-radius: 3px;
            padding: 5px 12px;
            font-weight: 500;
            color: #333;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .ielts-button:hover:not(:disabled) {
            background-color: #d1d1d1;
        }
        .ielts-button:disabled {
            background-color: #f5f5f5;
            color: #aaa;
            cursor: not-allowed;
            border-color: #d1d1d1;
        }
        .ielts-button-end {
            background-color: #d9534f;
            color: white;
            border-color: #d43f3a;
        }
         .ielts-button-end:hover:not(:disabled) {
            background-color: #c9302c;
            border-color: #ac2925;
         }
        .ielts-button-end:disabled {
            background-color: #e2827f;
            border-color: #dd716e;
        }
        textarea:disabled {
            background-color: #f5f5f5;
        }
        
        /* Custom scrollbar for a more authentic feel */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #bdbdbd; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        /* Modal styles */
        .modal-overlay { background-color: rgba(0, 0, 0, 0.6); }
        .modal-box {
            width: 90%;
            max-width: 550px;
        }
    </style>
</head>
<body class="text-gray-900 bg-gray-100 flex items-center justify-center min-h-screen">

    <!-- Question Setup Screen -->
    <div id="setupScreen" class="bg-white p-8 rounded-lg shadow-lg w-full max-w-2xl">
        <h1 class="text-2xl font-bold text-center mb-6 ielts-text-blue">IELTS Writing Task 2 Simulator Setup</h1>
        <div class="space-y-4">
            <div>
                <label for="promptInput" class="block text-sm font-medium text-gray-700 mb-1">Main Prompt</label>
                <textarea id="promptInput" rows="4" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Some people believe that unpaid community service should be a compulsory part of high school programmes...">Some people believe that unpaid community service should be a compulsory part of high school programmes (for example, working for a charity, improving the neighbourhood or teaching sports to younger children).</textarea>
            </div>
            <div>
                <label for="questionInput" class="block text-sm font-medium text-gray-700 mb-1">Question</label>
                <input type="text" id="questionInput" class="w-full border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., To what extent do you agree or disagree?" value="To what extent do you agree or disagree?">
            </div>
        </div>
        <div class="mt-8 text-center">
            <button id="startSimulatorBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-md text-lg transition-all shadow-md hover:shadow-lg">
                Start Simulator
            </button>
        </div>
    </div>


    <!-- Main Application Container -->
    <div id="app" class="max-w-7xl mx-auto my-4 bg-white shadow-lg rounded-lg border border-gray-300 h-[calc(100vh-2rem)] flex-col hidden">
        
        <!-- Header -->
        <header class="ielts-header-blue text-white flex justify-between items-center p-3 rounded-t-lg flex-shrink-0">
            <div class="flex items-center gap-4">
                <div class="font-bold text-lg">IELTS Writing</div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                    <span id="timer" class="bg-white text-gray-900 border border-gray-400 rounded px-3 py-1 text-lg font-bold tracking-wider">40:00</span>
                </div>
                <button id="helpBtn" class="ielts-button !bg-white/20 !text-white !border-white/50 hover:!bg-white/30">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                    Help
                </button>
                <button id="endTestBtn" class="ielts-button ielts-button-end">End Test</button>
            </div>
        </header>

        <!-- Main Content -->
        <main id="mainContent" class="flex flex-col md:flex-row border-t border-b border-gray-300 flex-grow overflow-y-hidden">
            
            <!-- Left Panel: Prompt -->
            <div id="promptPanel" class="w-full md:w-1/2 border-r border-gray-300 p-4 overflow-y-auto transition-all duration-300">
                <h2 class="font-bold mb-3 text-lg ielts-text-blue">Writing Task 2</h2>
                <p class="mb-4 text-sm">You should spend about 40 minutes on this task.</p>
                <p class="mb-4 text-sm">Write about the following topic:</p>
                <div class="border p-4 bg-gray-50 rounded-md text-sm">
                    <p id="promptText" class="font-semibold leading-relaxed"></p>
                    <p id="questionText" class="mt-3 font-bold"></p>
                </div>
                <p class="mt-4 text-sm">Give reasons for your answer and include any relevant examples from your own knowledge or experience.</p>
                <p class="mt-4 text-sm">Write at least 250 words.</p>
            </div>

            <!-- Right Panel: Writing Area -->
            <div id="writingPanel" class="w-full md:w-1/2 flex flex-col transition-all duration-300 relative">
                <textarea id="writingArea" class="w-full h-full border-t md:border-t-0 border-gray-300 rounded-none p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 flex-grow" placeholder="Type your response here..."></textarea>
            </div>
        </main>

        <!-- Footer -->
        <footer class="flex justify-between items-center p-2 rounded-b-lg bg-gray-100 border-t border-gray-300 flex-shrink-0">
             <div class="flex items-center space-x-2">
                 <button id="hideBtn" class="ielts-button text-sm">Hide Prompt</button>
                 <button id="cutBtn" class="ielts-button">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="6" cy="6" r="3"></circle><circle cx="6" cy="18" r="3"></circle><line x1="20" y1="4" x2="8.12" y2="15.88"></line><line x1="14.47" y1="14.48" x2="20" y2="20"></line><line x1="8.12" y1="8.12" x2="12" y2="12"></line></svg>
                     Cut
                 </button>
                 <button id="copyBtn" class="ielts-button">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                     Copy
                 </button>
                 <button id="pasteBtn" class="ielts-button">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                     Paste
                 </button>
             </div>
             <div class="text-right font-medium">
                 Word count: <span id="wordCount" class="font-bold text-lg ielts-text-blue">0</span>
             </div>
        </footer>
        
        <!-- Review Screen -->
        <div id="reviewScreen" class="p-6 md:p-8 flex-grow overflow-y-auto hidden">
            <h2 class="text-3xl font-bold text-center mb-6 ielts-text-blue">Test Completed</h2>
            <div class="bg-gray-50 p-4 rounded-lg shadow-inner mb-6 flex justify-around text-center">
                <div>
                    <p class="text-sm text-gray-600">Time Taken</p>
                    <p id="reviewTime" class="text-2xl font-bold ielts-text-blue">00:00</p>
                </div>
                <div>
                    <p class="text-sm text-gray-600">Word Count</p>
                    <p id="reviewWordCount" class="text-2xl font-bold ielts-text-blue">0</p>
                </div>
            </div>
            <div class="border p-4 bg-white rounded-md">
                <h3 class="font-bold mb-3 text-lg text-gray-800">Your Essay:</h3>
                <div id="reviewEssay" class="whitespace-pre-wrap text-gray-700 leading-relaxed max-h-80 overflow-y-auto bg-gray-50 p-3 rounded"></div>
            </div>
            <div class="mt-8 text-center">
                <button id="newTestBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-md text-lg transition-all shadow-md hover:shadow-lg">
                    Start a New Test
                </button>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-overlay fixed inset-0"></div>
        <div class="modal-box bg-white rounded-lg shadow-xl p-6 relative">
            <h3 class="text-xl font-bold mb-4 ielts-text-blue">Help Information</h3>
            <p class="mb-2 text-sm"><strong>Timer:</strong> The test ends automatically when the timer reaches 00:00.</p>
            <p class="mb-2 text-sm"><strong>Word Count:</strong> The word count updates as you type.</p>
            <p class="mb-2 text-sm"><strong>Hide/Show Prompt:</strong> Use this to maximize your writing area.</p>
            <p class="mb-4 text-sm"><strong>Editing:</strong> Use the Cut, Copy, and Paste buttons or standard keyboard shortcuts (Ctrl/Cmd + X/C/V).</p>
            <div class="text-right mt-6">
                <button id="closeHelpBtn" class="ielts-button bg-blue-600 text-white border-blue-700 hover:bg-blue-700">Close</button>
            </div>
        </div>
    </div>

    <!-- Time's Up Modal -->
    <div id="timesUpModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-overlay fixed inset-0"></div>
        <div class="modal-box bg-white rounded-lg shadow-xl p-6 text-center relative">
            <h3 class="text-xl font-bold mb-4 text-red-600">Time is Up!</h3>
            <p class="mb-5">Your time for this task has finished. Your answers would now be submitted.</p>
            <button id="closeTimesUpBtn" class="ielts-button bg-blue-600 text-white border-blue-700 hover:bg-blue-700">Acknowledge</button>
        </div>
    </div>
    
    <!-- End Test Confirmation Modal -->
    <div id="endTestConfirmModal" class="fixed inset-0 z-50 items-center justify-center hidden">
        <div class="modal-overlay fixed inset-0"></div>
        <div class="modal-box bg-white rounded-lg shadow-xl p-6 text-center relative">
            <h3 class="text-xl font-bold mb-4 text-yellow-600">End Test?</h3>
            <p class="mb-6">Are you sure you want to end the test? You cannot continue once you end it.</p>
            <div class="flex justify-center gap-4">
                 <button id="cancelEndTestBtn" class="ielts-button">Cancel</button>
                 <button id="confirmEndTestBtn" class="ielts-button ielts-button-end">End Test</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element Selection ---
            const app = document.getElementById('app');
            const setupScreen = document.getElementById('setupScreen');
            const startSimulatorBtn = document.getElementById('startSimulatorBtn');
            const writingArea = document.getElementById('writingArea');
            const wordCountEl = document.getElementById('wordCount');
            const timerEl = document.getElementById('timer');
            const hideBtn = document.getElementById('hideBtn');
            const promptPanel = document.getElementById('promptPanel');
            const writingPanel = document.getElementById('writingPanel');
            const mainContent = document.getElementById('mainContent');
            const footer = document.querySelector('footer');

            // Review Screen elements
            const reviewScreen = document.getElementById('reviewScreen');
            const reviewTime = document.getElementById('reviewTime');
            const reviewWordCount = document.getElementById('reviewWordCount');
            const reviewEssay = document.getElementById('reviewEssay');
            const newTestBtn = document.getElementById('newTestBtn');
            
            // Buttons
            const helpBtn = document.getElementById('helpBtn');
            const endTestBtn = document.getElementById('endTestBtn');
            const cutBtn = document.getElementById('cutBtn');
            const copyBtn = document.getElementById('copyBtn');
            const pasteBtn = document.getElementById('pasteBtn');
            
            // Modals
            const helpModal = document.getElementById('helpModal');
            const timesUpModal = document.getElementById('timesUpModal');
            const endTestConfirmModal = document.getElementById('endTestConfirmModal');

            // --- State Variables ---
            let isHidden = false;
            let timeInSeconds = 40 * 60;
            let timerInterval = null;
            let testActive = false;

            // --- Initial Setup ---
            writingArea.disabled = true;
            [endTestBtn, cutBtn, copyBtn, pasteBtn, hideBtn, helpBtn].forEach(btn => btn.disabled = true);

            // --- Core Functions ---
            const updateWordCount = () => {
                const text = writingArea.value.trim();
                const words = text === '' ? [] : text.split(/\s+/).filter(word => word.length > 0);
                wordCountEl.textContent = words.length;
            };

            const startTimer = () => {
                if (timerInterval) clearInterval(timerInterval); // Ensure no multiple timers
                timerInterval = setInterval(() => {
                    timeInSeconds--;
                    const minutes = Math.floor(timeInSeconds / 60);
                    const seconds = timeInSeconds % 60;
                    timerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                    if (timeInSeconds <= 0) {
                        endTest();
                        showModal(timesUpModal);
                    } else if (timeInSeconds < 5 * 60 && !timerEl.classList.contains('text-red-500')) {
                        timerEl.classList.remove('text-gray-900');
                        timerEl.classList.add('text-red-500', 'font-bold');
                    }
                }, 1000);
            };

            const startTest = () => {
                testActive = true;
                writingArea.disabled = false;
                [endTestBtn, cutBtn, copyBtn, pasteBtn, hideBtn, helpBtn].forEach(btn => btn.disabled = false);
                writingArea.focus();
                startTimer();
                updateWordCount();
            };

            const endTest = () => {
                if (!testActive) return;
                
                testActive = false;
                clearInterval(timerInterval);
                timerInterval = null;

                if (timeInSeconds < 0) timeInSeconds = 0; // Sanitize timer value
                const timeTakenInSeconds = (40 * 60) - timeInSeconds;
                const minutesTaken = Math.floor(timeTakenInSeconds / 60);
                const secondsTaken = timeTakenInSeconds % 60;
                
                reviewTime.textContent = `${String(minutesTaken).padStart(2, '0')}:${String(secondsTaken).padStart(2, '0')}`;
                reviewWordCount.textContent = wordCountEl.textContent;
                reviewEssay.textContent = writingArea.value;

                mainContent.classList.add('hidden');
                footer.classList.add('hidden');
                reviewScreen.classList.remove('hidden');

                writingArea.disabled = true;
                [endTestBtn, cutBtn, copyBtn, pasteBtn, hideBtn, helpBtn].forEach(btn => btn.disabled = true);
            };

            // --- Modal Management ---
            const showModal = (modal) => {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            };
            const hideModal = (modal) => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            };
            
            // --- Event Listeners ---
            startSimulatorBtn.addEventListener('click', () => {
                const promptValue = document.getElementById('promptInput').value;
                const questionValue = document.getElementById('questionInput').value;
                
                document.getElementById('promptText').innerText = promptValue.trim();
                document.getElementById('questionText').innerText = questionValue.trim();

                setupScreen.classList.add('hidden');
                app.classList.remove('hidden');
                app.classList.add('flex');

                startTest();
            });

            newTestBtn.addEventListener('click', () => {
                window.location.reload();
            });

            writingArea.addEventListener('input', updateWordCount);

            // Help Modal
            helpBtn.addEventListener('click', () => showModal(helpModal));
            document.getElementById('closeHelpBtn').addEventListener('click', () => hideModal(helpModal));
            helpModal.querySelector('.modal-overlay').addEventListener('click', () => hideModal(helpModal));

            // Time's Up Modal
            document.getElementById('closeTimesUpBtn').addEventListener('click', () => hideModal(timesUpModal));
            timesUpModal.querySelector('.modal-overlay').addEventListener('click', () => hideModal(timesUpModal));

            // End Test Confirmation
            endTestBtn.addEventListener('click', () => {
                if (testActive) showModal(endTestConfirmModal) 
            });
            document.getElementById('cancelEndTestBtn').addEventListener('click', () => hideModal(endTestConfirmModal));
            endTestConfirmModal.querySelector('.modal-overlay').addEventListener('click', () => hideModal(endTestConfirmModal));
            document.getElementById('confirmEndTestBtn').addEventListener('click', () => {
                hideModal(endTestConfirmModal);
                endTest();
            });

            // Hide/Show Prompt
            hideBtn.addEventListener('click', () => {
                isHidden = !isHidden;
                promptPanel.classList.toggle('hidden', isHidden);
                writingPanel.classList.toggle('md:w-1/2', !isHidden);
                writingPanel.classList.toggle('md:w-full', isHidden);
                hideBtn.textContent = isHidden ? "Show Prompt" : "Hide Prompt";
            });

            // Clipboard functionality
            cutBtn.addEventListener('click', () => document.execCommand('cut'));
            copyBtn.addEventListener('click', () => document.execCommand('copy'));
            
            // FIX: Updated paste functionality to use the modern, more reliable async clipboard API.
            pasteBtn.addEventListener('click', async () => {
                if (!navigator.clipboard || !navigator.clipboard.readText) {
                    console.warn("Clipboard API not available.");
                    return;
                }
                try {
                    writingArea.focus();
                    const text = await navigator.clipboard.readText();
                    if (!document.execCommand('insertText', false, text)) {
                        // Fallback for browsers that don't support insertText
                        const start = writingArea.selectionStart;
                        const end = writingArea.selectionEnd;
                        writingArea.value = writingArea.value.substring(0, start) + text + writingArea.value.substring(end);
                        writingArea.selectionStart = writingArea.selectionEnd = start + text.length;
                    }
                    updateWordCount();
                } catch (err) {
                    console.error('Failed to paste from clipboard: ', err);
                }
            });
            
            // FIX: Added event listener to close modals with the 'Escape' key for better accessibility.
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const activeModal = [helpModal, timesUpModal, endTestConfirmModal].find(
                        modal => !modal.classList.contains('hidden')
                    );
                    if (activeModal) {
                        hideModal(activeModal);
                    }
                }
            });
        });
    </script>
</body>
</html>
